local function AddLootIcons(self, event, message, ...)
    local function Icon(link)
        local texture = GetItemIcon(link)
        return "\124T" .. texture .. ":" .. 12 .. "\124t" .. link
    end
    message = message:gsub("(\124c%x+\124Hitem:.-\124h\124r)", Icon)
    return false, message, ...
end

ChatFrame_AddMessageEventFilter("CHAT_MSG_LOOT", AddLootIcons)
